---
import Layout from "../../layouts/Layout.astro";

interface ImageModule {
    default: { src: string };
}

const imageModules = import.meta.glob<ImageModule>("./*.jpg");
const imageFiles = await Promise.all(
    Object.values(imageModules).map(async (mod) => (await mod()).default.src),
);

const groupedImages: Record<string, string[]> = {};
imageFiles.forEach((file) => {
    if (file) {
        const prefix = file.split("-")[0];
        groupedImages[prefix] = [...(groupedImages[prefix] || []), file];
    }
});

const sortedGroups = Object.entries(groupedImages).sort((a, b) =>
    b[0].localeCompare(a[0]),
);
---

<Layout title="axseem's gallery">
    <div class="max-w-48 w-full flex flex-col gap-3">
        <div
            class="text-neutral-400 py-1 flex gap-1 border-b border-neutral-800 flex-wrap sticky top-0 bg-black z-10"
        >
            <a href="/">axseem</a>
            <span> / </span>
            <a href="/blog">blog</a>
            <a href="/diary">diary</a>
            <span class="text-neutral-50">gallery</span>
        </div>
        <h1>Gallery</h1>
        <div class="grid grid-cols-3 gap-0.5">
            {
                sortedGroups.map(([prefix, images]) => (
                    <img
                        src={images[0]}
                        class="thumbnail border-none rounded-none object-cover aspect-square"
                        data-group={prefix}
                        alt={`Thumbnail ${prefix}`}
                    />
                ))
            }
        </div>
    </div>
</Layout>
