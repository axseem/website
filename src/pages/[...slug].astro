---
import {
    getCollection,
    getEntry,
    render,
    type CollectionEntry,
} from "astro:content";
import BaseLayout from "../layouts/Base.astro";
import PageLayout from "../layouts/Page.astro";

export async function getStaticPaths() {
    const allPosts = await getCollection("content");
    return allPosts.map((post: CollectionEntry<"content">) => ({
        params: { slug: post.id },
    }));
}

const { slug } = Astro.params;

if (slug === undefined) {
    throw new Error("Slug is required");
}

const post = await getEntry("content", slug);

if (!post) {
    return Astro.redirect("/404");
}

const { Content } = await render(post);

const fileBaseName = slug.split("/").pop() ?? slug;
const titleFromFileName = fileBaseName
    .replace(/[-_]+/g, " ")
    .split(" ")
    .filter(Boolean)
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
    .join(" ");
---

<BaseLayout title={titleFromFileName}>
    <PageLayout>
        <article>
            <div class="content">
                <Content />
            </div>
        </article>
    </PageLayout>
</BaseLayout>

<style>
    .title {
        margin-bottom: 0.5rem;
    }
    .content {
        display: flex;
        flex-direction: column;
        margin-top: 2rem;
    }
</style>
