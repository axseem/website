---
import Layout from "../layouts/Layout.astro";
import Post from "../components/Post.astro";
import type { Props as PostProps } from "../components/Post.astro";

async function processPosts(
  modules: Record<string, () => Promise<{ frontmatter: PostProps }>>,
  basePath: string,
) {
  const posts = await Promise.all(
    Object.entries(modules).map(async ([path, mod]) => {
      const { frontmatter } = await mod();
      const slug = path.split("/").at(-1)?.replace(".md", "");
      return { ...frontmatter, url: `/${basePath}/${slug}/` };
    }),
  );

  return posts.sort((a, b) => Date.parse(b.date) - Date.parse(a.date));
}

const blog = await processPosts(
  import.meta.glob<{ frontmatter: PostProps }>("./blog/*.md"),
  "blog",
);
const diary = await processPosts(
  import.meta.glob<{ frontmatter: PostProps }>("./diary/*.md"),
  "diary",
);
---

<Layout title="@axseem">
  <div class="flex flex-col max-w-48 gap-2 md:pt-4 pb-4">
    <div class="flex flex-col gap-1">
      <h1>Hi' I'm Max</h1>
      <p class="text-neutral-200">
        Also known as @axseem or Maksym Bohdan. Here you will find my thoughts,
        projects, ideas and much more.
      </p>
      <p>
        <a target="_blank" href="mailto:max@axseem.me">Email</a>
        <a target="_blank" href="https://www.github.com/axseem">GitHub</a>
        <a target="_blank" href="https://www.instagram.com/axseem">Instagram</a>
        <a target="_blank" href="https://www.x.com/axseemm">X</a>
      </p>
    </div>

    <section class="flex flex-col gap-1">
      <h2>Blog</h2>
      <ul class="flex flex-col gap-1">
        {
          blog.map((post) => (
            <li>
              <Post {...post} />
            </li>
          ))
        }
      </ul>
    </section>

    <section class="flex flex-col gap-1">
      <h2>Diary</h2>
      <ul class="flex flex-col gap-1">
        {
          diary.map((post) => (
            <li>
              <Post {...post} />
            </li>
          ))
        }
      </ul>
    </section>
  </div>
</Layout>
